# 教育DSL设计 (Education DSL Design)

标签（空格分隔）： strongene smartedu design

---

## 注意：阅读此文档请直接阅读**源码**
## Domain-Specific Languange (DSL) 设计思想
教育DSL (Education DSL, EDSL) 是专为教育系统题目排版设计的一种DSL，其设计体现了以下思想：

- 仅针对教育领域
- 解决题目描述与显示之间的转换问题
- 支持提取题目的一部分用作显示
- 题目描述简单，符合普通教师的思维
- 从现有word文本复制粘贴改动少
- 有一定扩展性

特别的，与HTML语言比，EDSL的特色为：

- 文本直接复制粘贴即可基本显示正常（除空格、换行等格式外）
- 保留字均是不常用字符，不会出现<>错误解析等问题
- 解析简单，语法相比HTML增加了限制
- 可以方便地定义树状题目结构，以及显示题目的一部分

## 具体设计方案
### 0. 定义
- 本文档所设计的语言称为**EDSL**
- EDSL定义了如何用**字符串**表示**具有结构的题目**
- 输入的字符串也称为**代码**
- 表示的过程也称为**显示**
- 表示目标也简称为**题目**
- 提取题目的一部分也称为**抽取**，抽取结果也称为**小题**

### 1. 保留字与转义符
    保留字
    - 所有以##和$$开头的都是保留字，保留字中可以包含数字和字母，此外还有@@ #{ #} ${ $} *{ *} ** @  #  $  (最后三个每个最后一个字符都是空格)十一个特别的保留字
      普通保留字例如##{ $$a等，目前均没有定义
    - 为了方便解析，## $$ ** 三个保留字均在后面跟其他符号情况下使用，而@@直接使用，用作分隔符，其后不跟其他字符
    
    转义符
    - EDSL中与保留字冲突的符号需要转义符
    - ** 显示为*
    - # (#空格)显示为#，@ (@空格)显示为@,  $ ($空格)显示为$, 
      例如，显示###，则代码为# # # 

### 2. 语法
EDSL代码包含两个部分：题目代码和子题目描述子（简称描述子）
题目代码中包含以下三类基本语法元素：EDSL字符串 (简称字符串)，特定域，代码块

#### 2.1 EDSL字符串
- 连续的不包含保留字的文字或符号组成EDSL字符串
- EDSL字符串中连续空格会保留1个，回车会舍去，其他字符会直接显示（类似latex语法）
- 字符串是EDSL代码的基本元素

#### 2.2 特定域
- 除公式域外，其余的特定域格式为#{name@@content#}，name为域名，content为域内容
- 可以通过扩展特定域域名的定义增加新的特定域
- 特定域域名**必须**紧邻#{符号，且后面必须紧邻@@符号
- 特定域用于实现特定功能，如数学公式、输入模块等
- 不同功能的域域名必须是**不同**的
- 不同特定域也有特别的名称，如公式域、输入域等
- 特定域是EDSL代码的基本元素
    特定域样例：${ax^2+bx+c=0$} #{underline@@middle#} #{select@@选项一@@ax^2@@选项三#} #{br#} #{   #} （用以显示多个连续空格）

#### 2.3 代码块
- EDSL的两类基本元素都是代码块
- 在 *{ 与 *} 之间的内容组成一个代码块
- 代码块可以将多个代码块进行组合
- 代码块按其子块顺序显示
- 代码块符号不显示，代码块之间的空格、回车等符号不显示（用以支持不同的编码风格）

    代码样例：
已知${ax^2+bx+c=0$}, 求*{1) ${a+b$},*} #{br#} 
*{
    *{2.1) ${c+d$}, #{br#}*}
    *{2.2) ${e+f$},*} #{br#}
*}

##### 2.3.1 代码树与代码块编号
- 代码块形成的树称为代码树
- 树叶只能是两类基本元素之一
- 只有代码块分配编号，**编号会随着题目代码改变而改变**

代码块编号方式为：

- 每个子树编号（子编号）均从1开始依次递增
- 根节点不编号
- 基本元素不编号，只有代码块编号
- 其每个子节点编号与父节点编号用.隔开

    例如2.3中代码树与编号为：
    -- 已知${ax^2+bx+c=0$}, 求
    -- 1
    -- -- 1) ${a+b$},
    -- #{br#} 
    -- 2
    -- -- 2.1
    -- -- -- 2.1) ${c+d$}, #{br#}
    -- -- 2.2
    -- -- -- 2.2) ${e+f$},
    -- -- #{br#}

#### 2.4 描述子
- 描述子用于描述一个题目中需要显示的字部分
- 0表示全部显示
- 如需要部分显示，则给出所有需要部分显示的结点编号，用逗号隔开，每个逗号后面加一个空格
- **显示结点的所有树干上未编号的部分均会显示**

以2.3中为例：

描述子 1 会显示
    -- 已知${ax^2+bx+c=0$}, 求
    -- 1
    -- -- 1) ${a+b$},
    -- #{br#} 
    
描述子 2.1 会显示
    -- 已知${ax^2+bx+c=0$}, 求
    -- #{br#} 
    -- 2
    -- -- 2.1
    -- -- -- 2.1) ${c+d$}, #{br#}
    -- -- #{br#}
    
描述子 1, 2.1 会显示
    -- 已知${ax^2+bx+c=0$}, 求
    -- 1
    -- -- 1) ${a+b$},
    -- #{br#} 
    -- 2
    -- -- 2.1
    -- -- -- 2.1) ${c+d$}, #{br#}
    -- -- #{br#}

### 3. 其他
#### 3.1 已定义的保留字
- #  $  *  @  分别显示为# $ * @
- #{ #}用作输入域与常用特定域，${ $}用作公式域
- *{ *}用作代码块
- @@用作分隔符

#### 3.2 输入域与常用特定域
- 下划线填空区域：#{underline@@xxx#}  xxx可以为 short/middle/long
- 空白单张填空区域：#{blank#}
- 空白多张填空区域：#{multiblank#}
- 选择区域：#{select@@@@@@} 用@@隔开不同的选项
- 换行：#{br#}
- 多个连续空白：#{   #}
- 表格：#{row@@#{col@@a@@b@@c#}@@#{col@@a@@b@@c#}#} 同一行的元素用#{col@@xxx#}表示，不同行用#{row@@xxx#}
- 特殊格式的文本#{text@@[ubipr]@@要书写的文字#}，其中，[ubipr]为若干单个字符组成的文本格式描述子，u:下划线, b:加粗, i:斜体, p:下面加点, r:红色显示。
    
### 4. 已知问题
- 复制粘贴后，所有换行都得手动加入#{br#}标签
- # $ @ 复制粘贴后需要在后面加空格
- 一连串的***，需要把这些*复制粘贴一份才能正常显示
- 表格中加入输入区域后，显示排版仍然会有问题，所以仍然不能在表格中有输入区域（非语言问题）

